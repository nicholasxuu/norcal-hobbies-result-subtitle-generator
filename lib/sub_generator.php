<?php

require_once("core.php");
require_once("result_analyzer.php");

/***
 * subtitle creation
 */

$default_ass_format = "
[Script Info]
; Script generated by Aegisub 3.0.2
; http://www.aegisub.org/
Title:
Original Script:
Script Updated By: version 2.8.01
ScriptType: v4.00+
Collisions: Normal
PlayDepth: 0
Timer: 100,0000
Video Aspect Ratio: c1.77778
Video Zoom: 6
Scroll Position: 0
Active Line: 0
Video Zoom Percent: 0.5
Video File: 
YCbCr Matrix: TV.601

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: DefaultVCD,Segoe UI Mono,8,&H33FFFFFF,&H00B4FCFC,&H01000008,&H80000008,-1,0,0,0,100,100,0,0,1,1,0,9,5,5,5,0

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
";
 
function sub_generator($total_data, $race_name, $init_time, $race_minutes, $output_filename) {
	global $default_ass_format;
	
	set_std_dev($total_data, $race_name);
	
	
	$ass_output = $default_ass_format;

	//$ass_output = get_personal_ass($total_data, $race_name, $racer_number, $init_time, $ass_format);


	$ass_output .= get_all_live_info_ass($total_data, $race_name, $init_time, $race_minutes, "\\an7");
	//echo $ass_output;
	//echo var_dump($ass_output);

	//echo var_dump(get_timer_ass($init_time, $race_minutes, $total_data, $race_name, "\\an8\\fscx200\\fscy200\\fnQuartz MS"));
	$ass_output .= get_timer_ass($init_time, $race_minutes, $total_data, $race_name, "\\an8\\fscx200\\fscy200\\fnQuartz MS");

	if (1) {
	$fp = fopen($output_filename, "w");
	fwrite($fp, $ass_output);
	fclose($fp);
	}
	
	echo "Race: {$race_name} finished.\n";
}

function batch_sub_generator($total_data, $race_minutes, $init_time_arr=array(), $output_filename_arr=array()) {
	$default_init_time = 5;
	
	foreach ($total_data as $race_name => $race_data) {
		if (empty($init_time_arr)) {
			$this_init_time = $default_init_time;
		} else {
			$this_init_time = $init_time[$race_name];
		}
		
		if (empty($output_filename_arr)) {
			$this_output_filename = $race_name;
		} else {
			$this_output_filename = $output_filename_arr[$race_name];
		}
		
		sub_generator($total_data, $race_name, $this_init_time, $race_minutes, $this_output_filename);
		
		
	}
}